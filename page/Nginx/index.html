<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Phoenix Nemo">
    <meta name="description" content="MinoriWiki demo site">
    <title>
                Nginx - MinoriWiki Demo            </title>
    <link href="/MinoriWiki/assets/bootstrap.min.css" rel="stylesheet"/>
    <link href="/MinoriWiki/assets/style.css" rel="stylesheet"/>
    <script src="/MinoriWiki/assets/highlight.min.js"></script>
    <base target="_blank">
</head>
<body>
<div class="container">
    <div class="page-header">
                <h1><a href="/MinoriWiki/" class="logo-text" target="_self">MinoriWiki Demo</a>&nbsp;
                        <small>/ Nginx</small>
                    </h1>
            </div>
<div class="row">
<!-- two columns -->
<div class="col-lg-3 col-md-3">
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">About</h3>
    </div>
    <div class="panel-body">
		<p>This is the demo site of <a href="https://github.com/phoenixlzx/MinoriWiki">MinoriWiki</a></p>
		<p>And a partial mirror of <a href="https://felixc.at">FelixWiki</a>.</p>
    </div>
</div>
<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">Navigation</h3>
    </div>
    <div class="panel-body">
        <h6><a href="/MinoriWiki/" target="_self">Homepage</a></h6>
                <h5>Server Configuration</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/DNSMasq" target="_self">
                                        DNSMasq                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/MongoDB" target="_self">
                                        MongoDB                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/Nginx" target="_self">
                                        Nginx                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/PHP" target="_self">
                                        PHP                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/SSH" target="_self">
                                        SSH                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/Linux/Security" target="_self">
                                                            Linux / Linux Security                                    </a>
            </li>
                    </ul>
                <h5>Network Operation</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/DoS" target="_self">
                                        DoS                                    </a>
            </li>
                    </ul>
                <h5>Network Configuration</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/NAT" target="_self">
                                        NAT                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/PortForwarding" target="_self">
                                        PortForwarding                                    </a>
            </li>
                    </ul>
                <h5>Desktop Related</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/Tmux" target="_self">
                                        Tmux                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/URxvt" target="_self">
                                        URxvt                                    </a>
            </li>
                    </ul>
                <h5>Arch Linux</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/archlinux-on-loopback" target="_self">
                                        Install ArchLinux onto loopback filesystem                                    </a>
            </li>
                    </ul>
                <h5>Uncategoried</h5>
        <ul class="list-unstyled">
                        <li>
                <a href="/MinoriWiki/page/testv1" target="_self">
                                        testv1                                    </a>
            </li>
                        <li>
                <a href="/MinoriWiki/page/Test-Page" target="_self">
                                        Formatting Test Page                                    </a>
            </li>
                    </ul>
                        <hr/>
        <a href="/MinoriWiki/changelog">Changelog</a>
            </div>
</div>
</div>
<div class="col-lg-9 col-md-9 col-sm-12">
<div class="index-content">
<div class="row">
<span class="label label-primary pull-right">Server Configuration</span>
</div>
<div class="row">
<h4><a href="#Installation_on_Ubuntu_Server" name="Installation_on_Ubuntu_Server" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Installation on Ubuntu Server</h4>
<pre><code>apt-get install software-properties-common

add-apt-repository ppa:nginx/stable

apt-get update; apt-get install nginx -y
</code></pre>
<h4><a href="#Installation_on_Debian_Server" name="Installation_on_Debian_Server" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Installation on Debian Server</h4>
<pre><code>wget http://www.dotdeb.org/dotdeb.gpg -O - | apt-key add -

tee /etc/apt/sources.list.d/dotdeb.list &lt;&lt; EOF
deb http://mirror.us.leaseweb.net/dotdeb/ wheezy all
deb-src http://mirror.us.leaseweb.net/dotdeb/ wheezy all
EOF

apt-get update; apt-get install nginx -y
</code></pre>
<h4><a href="#Proxy" name="Proxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Proxy</h4>
<pre><code>resolver 8.8.4.4;
server {
    listen 3128;
    location / {
        proxy_pass http://$http_host$request_uri;
    }
}
</code></pre>
<h4><a href="#Reverse_Proxy" name="Reverse_Proxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Reverse Proxy</h4>
<pre><code>server {
    listen 80;
    server_name new-site.com;

    location / {
        proxy_pass http://origin-site.com/;
        proxy_redirect default;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        port_in_redirect    on;
        server_name_in_redirect off;
        proxy_connect_timeout 300;
    }
}
</code></pre>
<h4><a href="#Cached_Reverse_Proxy" name="Cached_Reverse_Proxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Cached Reverse Proxy</h4>
<p>Make directories for cache:</p>
<pre><code>mkdir -p /var/cache/nginx/cache
mkdir -p /var/cache/nginx/temp
</code></pre>
<p>Paste below <code>log_format</code> directive in <code>nginx.conf</code>:</p>
<pre><code>client_body_buffer_size  512k;
proxy_connect_timeout    5;
proxy_read_timeout       60;
proxy_send_timeout       5;
proxy_buffer_size        16k;
proxy_buffers            4 64k;
proxy_busy_buffers_size 128k;
proxy_temp_file_write_size 128k;
proxy_temp_path   /var/cache/nginx/temp;
proxy_cache_path  /var/cache/nginx/cache levels=1:2 keys_zone=cache_one:500m inactive=7d max_size=30g;
</code></pre>
<p>Add to vhost configuration:</p>
<pre><code>proxy_cache cache_one;
proxy_cache_valid  200 304 3d;
proxy_cache_key $host$uri$is_args$args;
expires 10d;
</code></pre>
<h4><a href="#Set_Expires_Headers_For_Static_Content" name="Set_Expires_Headers_For_Static_Content" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Set Expires Headers For Static Content</h4>
<pre><code>location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
    expires 1y;
    log_not_found off;
}
</code></pre>
<h4><a href="#Increase_HTTP_Post_Size_Limit" name="Increase_HTTP_Post_Size_Limit" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Increase HTTP Post Size Limit</h4>
<pre><code>http {
    #...
    client_max_body_size 100m;
    #...
}
</code></pre>
<h4><a href="#Set_Correct_Files/Folders_Permissions" name="Set_Correct_Files/Folders_Permissions" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Set Correct Files/Folders Permissions</h4>
<pre><code>chown -R www-data:www-data .
find . -type f -exec chmod 644 {} \;
find . -type d -exec chmod 755 {} \;
</code></pre>
<p>References:</p>
<ol>
<li><a href="http://wiki.ptsang.net/Debian%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE">http://wiki.ptsang.net/Debian%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE</a></li>
<li><a href="http://nicholaskuechler.com/2011/04/24/nginx-how-to-set-expires-headers-for-images/">http://nicholaskuechler.com/2011/04/24/nginx-how-to-set-expires-headers-for-images/</a></li>
<li><a href="http://www.vpsmm.com/blog-2522.html">http://www.vpsmm.com/blog-2522.html</a></li>
<li><a href="http://rtcamp.com/wordpress-nginx/tutorials/php/increase-file-upload-size-limit/">http://rtcamp.com/wordpress-nginx/tutorials/php/increase-file-upload-size-limit/</a></li>
</ol>
<p><em>Last Update: Fri Jan 22 2016 00:00:20 GMT+0900 (JST)</em>  <a href="/MinoriWiki/raw/Nginx.md">Source File</a></p>
</div>
<div class="row">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'minoriwikidemo';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
</div>
</div>
</div>
</div>
<div class="footer">
    <div class="footer-text">
        <p>
            MinoriWiki Demo using <a href="https://github.com/phoenixlzx/MinoriWiki" target="_blank">MinoriWiki</a>
        </p>
    </div>
</div>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
